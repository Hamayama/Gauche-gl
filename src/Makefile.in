CC = @CC@
CFLAGS = @CFLAGS@ @X_CFLAGS@ @GLUT_INCDIR@
LDFLAGS = @LDFLAGS@
LIBS = -lGLU -lGL @LIBS@ @X_LIBS@ @X_PRE_LIBS@ -lXext -lX11
GOSH = @GOSH@
GAUCHE_CONFIG = @GAUCHE_CONFIG@
GAUCHE_TOP = @GAUCHE_TOP@
INSTALL = @INSTALL@

ARCHFILES = gauche-gl.so gauche-glut.so
SCMFILES = 
HEADERS = 

TARGET = gauche-gl.so gauche-glut.so
GLOBJS = gauche-gl.o gl-lib.o glu-lib.o
GLUTOBJS = gauche-glut.o glut-lib.o
OBJS = $(GLOBJS) $(GLUTOBJS)
CONFIG_GENERATED = Makefile config.cache config.log config.status
GENERATED = gl-lib.c glu-lib.c glut-lib.c gettype-sizes.c 

INSTALL_TYPE = @INSTALL_TYPE@
HEADER_INSTALL_DIR  = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)incdir`
SCM_INSTALL_DIR     = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)libdir`
ARCH_INSTALL_DIR    = `$(GAUCHE_CONFIG) --$(INSTALL_TYPE)archdir`

all : $(TARGET)

gauche-gl.so : $(GLOBJS)
	$(CC) $(LDFLAGS) gauche-gl.so $(GLOBJS) $(LIBS)

gl-lib.c : gl-lib.stub
	$(GOSH) genstub gl-lib.stub

glu-lib.c : glu-lib.stub
	$(GOSH) genstub glu-lib.stub

gauche-gl.c : gettype-sizes.c

gettype-sizes.c : glstate.scm
	$(GOSH) glstate.scm -o gettype-sizes.c gettype

$(GLOBJS) : gauche-gl.h

gauche-glut.so : $(GLUTOBJS)
	$(CC) $(LDFLAGS) gauche-glut.so $(GLUTOBJS) @GLUT_LIBDIR@ @GLUT_LIB@ -lXmu -lXi $(LIBS)

glut-lib.c : glut-lib.stub
	$(GOSH) genstub glut-lib.stub

$(GLUTOBJS) : gauche-glut.h

test : all
	@rm -f test.log
	$(GOSH) test.scm > test.log

install : all
	@for f in $(HEADERS) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 444 $$f $(HEADER_INSTALL_DIR); \
	  fi; \
	done
	@for f in $(SCMFILES) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 444 $$f $(SCM_INSTALL_DIR); \
	  fi; \
	done
	@for f in $(ARCHFILES) _end; do \
	  if test $$f != _end; then \
	    $(INSTALL) -m 555 $$f $(ARCH_INSTALL_DIR); \
	  fi; \
	done

clean :
	rm -rf core $(TARGET) $(OBJS) *~ test.log so_locations

distclean : clean
	rm -rf $(CONFIG_GENERATED)

realclean : clean
	rm -rf $(CONFIG_GENERATED) $(GENERATED) configure
